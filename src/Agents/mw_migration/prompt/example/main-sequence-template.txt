<?xml version="1.0" encoding="UTF-8"?>
<sequence name="(service_name)-main-sequence" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <property expression="$body/ExternalServiceRequest/GLETxnID/text()" name="GLETxnID" scope="default" type="STRING"/>
    <property expression="$body/ExternalServiceRequest/DestinationAccountID/text()" name="refnum" scope="default" type="STRING"/>
    <property expression="$body/ExternalServiceRequest/DestinationAccountID/text()" name="referenceNumber" scope="default" type="STRING"/>
    <property expression="$body/ExternalServiceRequest/xparam/inquiry_key/text()" name="inquiry_key" scope="default" type="STRING"/>
    <property expression="$body/ExternalServiceRequest/xparam/service_id_aman/text()" name="ServiceCode" scope="default" type="STRING"/>
    <property expression="$body/ExternalServiceRequest/xparam/terminalId/text()" name="terminal" scope="default" type="STRING"/>
    <property expression="$body/ExternalServiceRequest/xparam/productCode/text()" name="productCode" scope="default" type="STRING"/>
    <class name="com.aman.mediator.(service_name)Mediator">
        <property name="propertyFilePath" value="dev.properties"/>
    </class>
    <switch source="$ctx:ServiceCode">
        <case regex="(inquiry-service-code)">
            <sequence key="(service_name)-inquiry_request"/>
            <sequence key="(service_name)-inquiry-response"/>
        </case>
        <case regex="(payment-service-code)">
            <sequence key="(service_name)-payment_request"/>
            <sequence key="(service_name)-payment-response"/>
        </case>
        <default>
            <payloadFactory media-type="xml">
                <format>
                    <ExternalServiceResponse xmlns="">
                        <EXTTxnID/>
                        <TransactionTimeStamp>$1</TransactionTimeStamp>
                        <Status>esb:INVALID_SEQUENCE</Status>
                        <Message>ESB invalid sequence</Message>
                    </ExternalServiceResponse>
                </format>
                <args>
                    <arg evaluator="xml" expression="get-property('SYSTEM_DATE', 'yyyy-MM-dd HH:mm:ss.SSS')"/>
                </args>
            </payloadFactory>
            <property description="MessageType" name="messageType" scope="axis2" type="STRING" value="application/xml"/>
            <log description="LogResponse" level="full"/>
            <respond/>
        </default>
    </switch>
    <respond/>
</sequence>